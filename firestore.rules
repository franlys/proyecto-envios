rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ==================== COLECCIÃ“N: empleados ====================
    // ðŸ”¥ NUEVA - Esta es la que falta y causa el error
    match /empleados/{empleadoId} {
      // Permitir que cada empleado lea su propio documento
      allow read: if request.auth != null && request.auth.uid == empleadoId;
      
      // Permitir que cada empleado actualice su propio perfil
      allow update: if request.auth != null && request.auth.uid == empleadoId;
      
      // Admins pueden leer/escribir cualquier empleado
      allow read, write: if request.auth != null 
        && exists(/databases/$(database)/documents/empleados/$(request.auth.uid))
        && get(/databases/$(database)/documents/empleados/$(request.auth.uid)).data.rol == 'admin';
    }

    // Regla para usuarios (mantenemos por compatibilidad)
    match /usuarios/{userId} {
      allow read, update: if request.auth != null && request.auth.uid == userId;
      allow create, read: if request.auth != null;
    }

    // Regla para la colecciÃ³n 'recolecciones'
    match /recolecciones/{recoleccionId} {
      allow read, write: if request.auth != null;
    }

    // Regla para la colecciÃ³n 'contenedores'
    match /contenedores/{contenedorId} {
      allow read, write: if request.auth != null;
    }

    // Regla para embarques
    match /embarques/{embarqueId} {
       allow read, write: if request.auth != null;
    }

     // Regla para rutas
    match /rutas/{rutaId} {
       allow read, write: if request.auth != null;
    }

     // Regla para gastos
    match /gastos/{gastoId} {
       allow read, write: if request.auth != null;
    }

     // Regla para historial_reasignaciones
    match /historial_reasignaciones/{historialId} {
       allow read, write: if request.auth != null;
    }

     // Regla para companies
    match /companies/{companyId} {
       allow read, write: if request.auth != null;
    }

     // Regla para tickets
    match /tickets/{ticketId} {
       allow read, write: if request.auth != null;
    }
  }
}